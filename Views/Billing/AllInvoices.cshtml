@model List<STOCKER.Models.SalesInvoice>
@using System.Globalization

@{
    ViewData["Title"] = "All Invoices";
}


<div class="d-flex justify-content-between align-items-center mt-3 mb-4">
    <h2>All Invoices</h2>
    <div class="btn-group mb-3">
        <a class="btn btn-outline-primary @(Context.Request.Query["status"] == "" ? "active" : "")"
           asp-action="AllInvoices">All</a>
        <a class="btn btn-outline-success @(Context.Request.Query["status"] == "Paid" ? "active" : "")"
           asp-action="AllInvoices" asp-route-status="Paid">Paid</a>
        <a class="btn btn-outline-danger @(Context.Request.Query["status"] == "Unpaid" ? "active" : "")"
           asp-action="AllInvoices" asp-route-status="Unpaid">Unpaid</a>
    </div>

    <form asp-action="AllInvoices" method="get" class="d-flex">
        <input type="text" name="search" value="@Context.Request.Query["search"]" class="form-control me-2" placeholder="Search by name or invoice #" />
        <button type="submit" class="btn btn-outline-primary">Search</button>
    </form>
</div>

    @if (!Model.Any())
    {
        <p>No invoices found.</p>
    }
    else
    {
        <table class="table table-striped table-bordered">
            <thead>
                <tr>
                    <th>Invoice #</th>
                    <th>Date</th>
                    <th>Customer</th>
                    <th>Total Amount</th>
                    <th>Actions</th>
                <th>Status</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var invoice in Model)
                {
                    var total = invoice.InvoiceDetails.Sum(d => d.Quantity * d.UnitPrice);
                    <tr>
                        <td>@invoice.InvoiceId</td>
                        <td>@invoice.Date.ToString("dd MMM yyyy hh:mm tt")</td>
                        <td>@invoice.CustomerName</td>
                        <td>@total.ToString("C", CultureInfo.GetCultureInfo("en-IN"))</td>
                        <td>
                            <a class="btn btn-sm btn-primary" asp-action="InvoiceSummary" asp-route-id="@invoice.InvoiceId">View</a>
                            <a class="btn btn-sm btn-secondary" asp-action="Download" asp-route-id="@invoice.InvoiceId">PDF</a>
                        </td>
                    <td>
                        <span class="badge @(invoice.PaymentStatus == "Paid" ? "bg-success" : "bg-danger")">
                            @invoice.PaymentStatus
                        </span>
                    </td>

                    </tr>
                }
            </tbody>
        </table>
    }
</div>
